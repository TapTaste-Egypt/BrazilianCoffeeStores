<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapTaste Mini Games</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1f1f2e, #3b2d4f);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    overflow-x: hidden;
    color: #fff;
  }

  /* Floating gaming icons animation */
  .icon {
    position: fixed;
    font-size: 2.2rem;
    color: rgba(255, 255, 255, 0.14);
    animation: floatIcons 12s infinite linear;
    z-index: 0;
    user-select: none;
    pointer-events: none;
  }
  @keyframes floatIcons {
    0%   { transform: translateY(110vh) rotate(0deg); }
    100% { transform: translateY(-10vh) rotate(360deg); }
  }

  header {
    text-align: center;
    margin-top: 10px;
    display: flex;
    justify-content: center;
    width: 100%;
    z-index: 1;
  }

  .top-logo { max-width: 160px; animation: fadeInDown 1s ease-in-out; }

  .tagline {
    font-size: 1.3rem;
    font-weight: 600;
    letter-spacing: 2px;
    background: linear-gradient(90deg, #ffcc70, #ff6f61);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-top: 10px;
    position: relative;
    display: inline-block;
    animation: fadeInTagline 1.2s ease-in-out forwards;
  }

  .tagline::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    height: 100%;
    width: 100%;
    background: linear-gradient(120deg, transparent, rgba(255,255,255,0.5), transparent);
    animation: shimmer 2.5s infinite;
  }

  @keyframes shimmer {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: 100%; }
  }

  @keyframes fadeInTagline {
    from { opacity: 0; transform: translateY(5px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Button Grid */
  .button-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    width: 100%;
    max-width: 520px;
    margin-top: 24px;
    z-index: 1;
  }

  .center-btn {
    display: flex;
    justify-content: center;
    margin-top: 18px;
    width: 100%;
    z-index: 1;
  }

  /* Button Style */
  .btn {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(12px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    font-weight: 600;
    padding: 14px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    transition: all 0.25s ease;
    text-align: center;
    cursor: pointer;
    font-size: 1rem;
    text-decoration: none;
    display: block;
    width: 100%;
  }
  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(0.2);
  }

  .btn i {
    display: block;
    font-size: 1.5rem;
    margin-bottom: 6px;
    transition: transform 0.25s ease;
  }

  .btn:hover:not(:disabled) {
    transform: translateY(-5px) scale(1.02);
    background: rgba(255, 255, 255, 0.22);
    box-shadow: 0 12px 28px rgba(0,0,0,0.15);
  }
  .btn:hover i { transform: scale(1.1); }

  /* Highlight Button */
  .highlight-btn {
    background: linear-gradient(135deg, #d4a373, #8b5e3c);
    color: white;
    border: none;
  }
  .highlight-btn:hover {
    background: linear-gradient(135deg, #b97d55, #6e452b);
  }

  footer {
    margin-top: auto;
    font-size: 0.85rem;
    color: #ddd;
    padding: 15px 0;
    text-align: center;
    z-index: 1;
  }

  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Game containers */
  .screen { width: 100%; display: none; }
  .active { display: block; }
  .screen-inner {
    margin: 20px auto;
    width: 100%;
    max-width: 820px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 18px;
    box-shadow: 0 10px 26px rgba(0,0,0,0.25);
    padding: 18px;
    backdrop-filter: blur(8px);
  }
  .screen-title {
    font-weight: 600;
    letter-spacing: .5px;
    margin-bottom: 10px;
    text-align: center;
  }

  /* TicTacToe styles */
  .tictactoe {
    display: grid;
    grid-template-columns: repeat(3, 110px);
    grid-template-rows: repeat(3, 110px);
    gap: 8px;
    justify-content: center;
    margin: 18px auto;
    user-select: none;
  }
  .cell {
    display: flex; align-items: center; justify-content: center;
    font-size: 2.2rem; font-weight: 700;
    background: rgba(255,255,255,0.18);
    border: 2px solid rgba(255,255,255,0.35);
    border-radius: 14px;
    cursor: pointer;
    transition: transform .15s ease, background .2s ease;
  }
  .cell:hover { transform: scale(1.03); }
  .tt-info { text-align: center; margin-top: 8px; font-weight: 600; }

  /* Caf√© Stack canvas */
  #stackCanvas {
    width: 100%;
    max-width: 420px;
    height: 560px;
    background: linear-gradient(180deg, #2a2438, #1c1b29 35%, #151422);
    border-radius: 16px;
    display: block;
    margin: 12px auto 6px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  }
  .stack-hud {
    display: flex; justify-content: space-between; gap: 10px;
    align-items: center; margin: 6px auto 10px; max-width: 420px;
  }
  .chip {
    padding: 8px 12px; border-radius: 999px; font-weight: 600;
    background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2);
  }
  .controls-hint { text-align: center; opacity: .85; font-size: .95rem; }

  /* Laptop view */
  @media (min-width: 992px) {
    .top-logo { max-width: 200px; }
    .tagline { font-size: 1.6rem; }
    .button-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 22px;
      max-width: 820px;
    }
    .btn { font-size: 1.05rem; padding: 18px; }
  }
</style>
</head>
<body>

<!-- Floating gaming icons -->
<span class="icon" style="left:5%; animation-delay: 0s;">üéÆ</span>
<span class="icon" style="left:20%; animation-delay: 3s;">üïπÔ∏è</span>
<span class="icon" style="left:40%; animation-delay: 6s;">üéØ</span>
<span class="icon" style="left:60%; animation-delay: 1s;">üèÜ</span>
<span class="icon" style="left:80%; animation-delay: 4s;">üéÆ</span>

<header>
  <div>
    <img src="../images/ChatGPT_Image_Aug_7__2025__07_27_03_AM-removebg-preview.png" alt="TapTaste Logo" class="top-logo">
    <h2 class="tagline">Brazilian Coffee Stores ‚Äî Mini Games</h2>
  </div>
</header>

<!-- Mode selection -->
<div id="menuScreen" class="screen active">
  <div class="button-grid">
    <button class="btn" onclick="selectMode('single')">
      <i class="fas fa-user"></i>
      Single Player
    </button>
    <button class="btn" onclick="selectMode('multi')">
      <i class="fas fa-users"></i>
      Multiplayer
    </button>
  </div>

  <!-- Game choices (filtered by mode) -->
  <div class="button-grid" id="gameChoices" style="display:none;">
    <a id="btnCafeStack" class="btn" href="#" onclick="openScreen('cafeStackScreen'); return false;">
      <i class="fas fa-mug-hot"></i>
      Caf√© Stack
    </a>
    <a id="btnTicTacToe" class="btn" href="#" onclick="openScreen('tictactoeScreen'); return false;">
      <i class="fas fa-table-cells"></i>
      TicTacToe
    </a>
  </div>

  <!-- Back to Home -->
  <div class="center-btn" style="margin-top: 20px;">
    <a href="../index.html" class="btn highlight-btn" style="max-width: 220px;">
      <i class="fas fa-arrow-left"></i>
      Back to Home
    </a>
  </div>
</div>

<!-- Caf√© Stack (Single Player) -->
<section id="cafeStackScreen" class="screen">
  <div class="screen-inner">
    <h3 class="screen-title">‚òï Caf√© Stack ‚Äî Single Player</h3>
    <div class="stack-hud">
      <span class="chip">Score: <span id="stackScore">0</span></span>
      <span class="chip">Best: <span id="stackBest">0</span></span>
      <button class="btn" style="max-width:180px;" onclick="stackRestart()"><i class="fas fa-rotate-right"></i> Restart</button>
    </div>
    <canvas id="stackCanvas" width="420" height="560"></canvas>
    <p class="controls-hint">Tap / Click / Space to drop the tray. Align well to keep stacking!</p>

    <div class="center-btn">
      <button class="btn highlight-btn" style="max-width:220px;" onclick="backToMenu()">
        <i class="fas fa-arrow-left"></i> Back to Menu
      </button>
    </div>
  </div>
</section>

<!-- TicTacToe (Multiplayer) -->
<section id="tictactoeScreen" class="screen">
  <div class="screen-inner">
    <h3 class="screen-title">üéÆ TicTacToe ‚Äî Multiplayer</h3>
    <div class="tt-info">Turn: <span id="ttTurn">X</span></div>
    <div class="tictactoe" id="ttBoard"></div>
    <div class="tt-info" id="ttStatus">First to 3 in a row wins!</div>
    <div class="center-btn" style="gap:12px;">
      <button class="btn" style="max-width:200px;" onclick="ttReset()"><i class="fas fa-rotate-right"></i> Reset</button>
      <button class="btn highlight-btn" style="max-width:220px;" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> Back to Menu</button>
    </div>
  </div>
</section>

<footer>¬© Copyrights to TapTaste</footer>

<script>
  /* --------- Screen / Menu logic --------- */
  let selectedMode = null;
  function selectMode(mode) {
    selectedMode = mode; // 'single' or 'multi'
    const gc = document.getElementById('gameChoices');
    const btnCafe = document.getElementById('btnCafeStack');
    const btnTTT  = document.getElementById('btnTicTacToe');

    gc.style.display = 'grid';
    if (mode === 'single') {
      btnCafe.disabled = false;
      btnTTT.disabled = true;
    } else {
      btnCafe.disabled = true;
      btnTTT.disabled = false;
    }
  }

  function openScreen(id) {
    // guard: only allow correct game per mode
    if (id === 'cafeStackScreen' && selectedMode !== 'single') return;
    if (id === 'tictactoeScreen' && selectedMode !== 'multi') return;

    document.getElementById('menuScreen').classList.remove('active');
    document.getElementById('menuScreen').style.display = 'none';

    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    const el = document.getElementById(id);
    el.classList.add('active');
    el.style.display = 'block';

    // Initialize games on open
    if (id === 'tictactoeScreen') ttInit();
    if (id === 'cafeStackScreen') stackInit();
  }

  function backToMenu() {
    document.querySelectorAll('.screen').forEach(s => {
      if (s.id !== 'menuScreen') s.style.display = 'none';
      s.classList.remove('active');
    });
    document.getElementById('menuScreen').style.display = 'block';
    document.getElementById('menuScreen').classList.add('active');
  }

  /* --------- TicTacToe (Multiplayer) --------- */
  const winLines = [
    [0,1,2], [3,4,5], [6,7,8], // rows
    [0,3,6], [1,4,7], [2,5,8], // cols
    [0,4,8], [2,4,6]           // diagonals
  ];
  let ttBoardState = Array(9).fill('');
  let ttCurrent = 'X';
  let ttGameOver = false;

  function ttInit() {
    const board = document.getElementById('ttBoard');
    board.innerHTML = '';
    for (let i = 0; i < 9; i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.idx = i;
      cell.addEventListener('click', ttPlace);
      board.appendChild(cell);
    }
    ttReset();
  }

  function ttPlace(e) {
    if (ttGameOver) return;
    const idx = +e.currentTarget.dataset.idx;
    if (ttBoardState[idx]) return;

    ttBoardState[idx] = ttCurrent;
    e.currentTarget.textContent = ttCurrent;

    if (ttCheckWin(ttCurrent)) {
      document.getElementById('ttStatus').textContent = ttCurrent + ' wins! üéâ';
      ttGameOver = true;
      return;
    }
    if (ttBoardState.every(v => v)) {
      document.getElementById('ttStatus').textContent = 'Draw ü§ù';
      ttGameOver = true;
      return;
    }
    ttCurrent = ttCurrent === 'X' ? 'O' : 'X';
    document.getElementById('ttTurn').textContent = ttCurrent;
    document.getElementById('ttStatus').textContent = 'First to 3 in a row wins!';
  }

  function ttCheckWin(p) {
    return winLines.some(line => line.every(i => ttBoardState[i] === p));
  }

  function ttReset() {
    ttBoardState = Array(9).fill('');
    ttCurrent = 'X';
    ttGameOver = false;
    document.getElementById('ttTurn').textContent = ttCurrent;
    document.getElementById('ttStatus').textContent = 'First to 3 in a row wins!';
    document.querySelectorAll('#ttBoard .cell').forEach(c => c.textContent = '');
  }

  /* --------- Caf√© Stack (Single Player) --------- */
  const canvas = document.getElementById('stackCanvas');
  const ctx = canvas.getContext('2d');
  let stackBlocks = [];
  let movingBlock = null;
  let baseWidth = 220;       // starting width
  let blockHeight = 20;
  let speed = 2.2;
  let direction = 1;
  let score = 0;
  let best = +localStorage.getItem('taptaste_stack_best') || 0;
  const scoreEl = document.getElementById('stackScore');
  const bestEl  = document.getElementById('stackBest');
  bestEl.textContent = best;
  let animId = null;
  let running = false;

  function stackInit() {
    // Setup base
    stackBlocks = [{
      x: (canvas.width - baseWidth)/2,
      y: canvas.height - blockHeight,
      w: baseWidth
    }];
    // First moving block
    createMovingBlock();
    score = 0;
    updateScore(0);
    running = true;
    cancelAnimationFrame(animId);
    loop();
  }

  function stackRestart() {
    cancelAnimationFrame(animId);
    speed = 2.2;
    direction = 1;
    blockHeight = 20;
    baseWidth = 220;
    stackInit();
  }

  function createMovingBlock() {
    const last = stackBlocks[stackBlocks.length - 1];
    movingBlock = {
      x: 0, // start from left
      y: last.y - blockHeight,
      w: last.w,
      phase: Math.random() < 0.5 ? 'left' : 'right'
    };
    // start from edge depending on phase
    movingBlock.x = movingBlock.phase === 'left' ? -movingBlock.w : canvas.width;
    direction = movingBlock.phase === 'left' ? 1 : -1;
  }

  function dropBlock() {
    if (!running || !movingBlock) return;

    const last = stackBlocks[stackBlocks.length - 1];
    // overlap calculation
    const overlapLeft  = Math.max(movingBlock.x, last.x);
    const overlapRight = Math.min(movingBlock.x + movingBlock.w, last.x + last.w);
    const overlap = overlapRight - overlapLeft;

    if (overlap <= 0) {
      // Game over
      running = false;
      gameOverSplash();
      if (score > best) {
        best = score;
        localStorage.setItem('taptaste_stack_best', best);
        bestEl.textContent = best;
      }
      return;
    }

    // Trim to overlap
    movingBlock.x = overlapLeft;
    movingBlock.w = overlap;

    // Add to stack
    stackBlocks.push({ x: movingBlock.x, y: movingBlock.y, w: movingBlock.w });

    // Increase difficulty
    speed += 0.12;
    if (movingBlock.w > 60 && stackBlocks.length % 3 === 0) {
      // slight height shrink occasionally
      blockHeight = Math.max(14, blockHeight - 1);
    }

    // Score & next block
    updateScore(1);
    createMovingBlock();

    // Raise stack if near top
    shiftUpIfNeeded();
  }

  function shiftUpIfNeeded() {
    const topY = stackBlocks[stackBlocks.length - 1].y;
    if (topY < 120) {
      // move everything down visually to keep play area
      const shift = 120 - topY;
      stackBlocks.forEach(b => b.y += shift);
      if (movingBlock) movingBlock.y += shift;
    }
  }

  function loop() {
    animId = requestAnimationFrame(loop);
    render();
    if (running && movingBlock) {
      movingBlock.x += speed * direction;
      // bounce at edges
      if (movingBlock.x <= -movingBlock.w) {
        direction = 1; movingBlock.phase = 'left';
      }
      if (movingBlock.x >= canvas.width) {
        direction = -1; movingBlock.phase = 'right';
      }
    }
  }

  function render() {
    // background
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const grd = ctx.createLinearGradient(0,0,0,canvas.height);
    grd.addColorStop(0,'#2a2438');
    grd.addColorStop(0.35,'#1c1b29');
    grd.addColorStop(1,'#151422');
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // draw subtle caf√© shelf
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    for (let i=0;i<6;i++){
      ctx.fillRect(20, canvas.height - 40 - i*90, canvas.width-40, 2);
    }

    // draw stack blocks (coffee trays / bars)
    stackBlocks.forEach((b, idx) => drawBlock(b, idx));
    if (movingBlock) drawBlock(movingBlock, stackBlocks.length, true);

    // top text
    if (!running) {
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.font = '700 24px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 8);
      ctx.font = '500 16px Poppins';
      ctx.fillText('Tap / click to restart', canvas.width/2, canvas.height/2 + 16);
    }
  }

  function drawBlock(b, idx, moving=false) {
    // colors get warmer as you go up
    const hueBase = 32; // coffee-ish
    const sat = 55;
    const light = Math.min(65, 40 + idx * 1.4);
    ctx.fillStyle = `hsl(${hueBase}, ${sat}%, ${light}%)`;
    roundRect(ctx, b.x+2, b.y+2, b.w-4, blockHeight-4, 8, true, false);

    // foam highlight
    ctx.fillStyle = 'rgba(255,255,255,0.12)';
    roundRect(ctx, b.x+8, b.y+4, Math.max(0, b.w-16), 6, 6, true, false);

    // moving glow
    if (moving) {
      ctx.strokeStyle = 'rgba(255,255,255,0.35)';
      ctx.lineWidth = 2;
      roundRect(ctx, b.x+1, b.y+1, b.w-2, blockHeight-2, 10, false, true);
    }
  }

  function roundRect(ctx, x, y, w, h, r, fill, stroke) {
    if (w < 0) return;
    if (typeof r === 'number') {
      r = {tl:r, tr:r, br:r, bl:r};
    } else {
      r = {tl: r.tl||0, tr:r.tr||0, br:r.br||0, bl:r.bl||0};
    }
    ctx.beginPath();
    ctx.moveTo(x+r.tl, y);
    ctx.lineTo(x+w-r.tr, y);
    ctx.quadraticCurveTo(x+w, y, x+w, y+r.tr);
    ctx.lineTo(x+w, y+h-r.br);
    ctx.quadraticCurveTo(x+w, y+h, x+w-r.br, y+h);
    ctx.lineTo(x+r.bl, y+h);
    ctx.quadraticCurveTo(x, y+h, x, y+h-r.bl);
    ctx.lineTo(x, y+r.tl);
    ctx.quadraticCurveTo(x, y, x+r.tl, y);
    ctx.closePath();
    if (fill) ctx.fill();
    if (stroke) ctx.stroke();
  }

  function updateScore(delta) {
    score += delta;
    document.getElementById('stackScore').textContent = score;
  }

  function gameOverSplash() {
    // tiny shake
    let t = 0, time = 10;
    const original = canvas.style.transform;
    const shake = () => {
      if (t++ < time) {
        canvas.style.transform = `translateX(${(Math.random()-0.5)*6}px)`;
        requestAnimationFrame(shake);
      } else {
        canvas.style.transform = original;
      }
    };
    shake();
  }

  // input handlers
  function handleStackInput() {
    if (!document.getElementById('cafeStackScreen').classList.contains('active')) return;
    if (running) {
      dropBlock();
    } else {
      stackRestart();
    }
  }
  canvas.addEventListener('click', handleStackInput);
  window.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      handleStackInput();
    }
  });
  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleStackInput(); }, {passive:false});

</script>
</body>
</html>
